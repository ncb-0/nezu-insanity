const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_app/immutable/chunks/enableLiveMode.DPEjVY0o.js","_app/immutable/chunks/index.browser.Caqoo78r.js","_app/immutable/chunks/preload-helper.D7HrI6pR.js","_app/immutable/chunks/stegaEncodeSourceMap.NlBhtwQT.js"])))=>i.map(i=>d[i]);
import{_ as Ye}from"./preload-helper.D7HrI6pR.js";import{w as Ve,g as We,d as Xe}from"./index.BB0j7sDI.js";import{g as Ge}from"./_commonjsHelpers.Cpj98o6Y.js";import{o as Ze}from"./index-client.B0NnqFmY.js";var ue,fe,G={},le,he,de,ge,ye,pe,me,ve,be,Z={exports:{}};function qe(){return le||(le=1,function(r,t){const{hasOwnProperty:c}=Object.prototype,a=b();a.configure=b,a.stringify=a,a.default=a,t.stringify=a,t.configure=b,r.exports=a;const i=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/;function s(m){return m.length<5e3&&!i.test(m)?`"${m}"`:JSON.stringify(m)}function u(m){if(m.length>200)return m.sort();for(let e=1;e<m.length;e++){const o=m[e];let d=e;for(;d!==0&&m[d-1]>o;)m[d]=m[d-1],d--;m[d]=o}return m}const f=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function l(m){return f.call(m)!==void 0&&m.length!==0}function n(m,e,o){m.length<o&&(o=m.length);const d=e===","?"":" ";let v=`"0":${d}${m[0]}`;for(let w=1;w<o;w++)v+=`${e}"${w}":${d}${m[w]}`;return v}function h(m,e){let o;if(c.call(m,e)&&(o=m[e],typeof o!="boolean"))throw new TypeError(`The "${e}" argument must be of type boolean`);return o===void 0||o}function p(m,e){let o;if(c.call(m,e)){if(o=m[e],typeof o!="number")throw new TypeError(`The "${e}" argument must be of type number`);if(!Number.isInteger(o))throw new TypeError(`The "${e}" argument must be an integer`);if(o<1)throw new RangeError(`The "${e}" argument must be >= 1`)}return o===void 0?1/0:o}function g(m){return m===1?"1 item":`${m} items`}function b(m){const e=function(R){if(c.call(R,"strict")){const y=R.strict;if(typeof y!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(y)return $=>{let T="Object can not safely be stringified. Received type "+typeof $;throw typeof $!="function"&&(T+=` (${$.toString()})`),new Error(T)}}}(m={...m});e&&(m.bigint===void 0&&(m.bigint=!1),"circularValue"in m||(m.circularValue=Error));const o=function(R){if(c.call(R,"circularValue")){const y=R.circularValue;if(typeof y=="string")return`"${y}"`;if(y==null)return y;if(y===Error||y===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(m),d=h(m,"bigint"),v=h(m,"deterministic"),w=p(m,"maximumDepth"),k=p(m,"maximumBreadth");function _(R,y,$,T,M,A){let S=y[R];switch(typeof S=="object"&&S!==null&&typeof S.toJSON=="function"&&(S=S.toJSON(R)),S=T.call(y,R,S),typeof S){case"string":return s(S);case"object":{if(S===null)return"null";if($.indexOf(S)!==-1)return o;let x="",P=",";const j=A;if(Array.isArray(S)){if(S.length===0)return"[]";if(w<$.length+1)return'"[Array]"';$.push(S),M!==""&&(x+=`
${A+=M}`,P=`,
${A}`);const U=Math.min(S.length,k);let D=0;for(;D<U-1;D++){const ce=_(String(D),S,$,T,M,A);x+=ce!==void 0?ce:"null",x+=P}const J=_(String(D),S,$,T,M,A);return x+=J!==void 0?J:"null",S.length-1>k&&(x+=`${P}"... ${g(S.length-k-1)} not stringified"`),M!==""&&(x+=`
${j}`),$.pop(),`[${x}]`}let z=Object.keys(S);const I=z.length;if(I===0)return"{}";if(w<$.length+1)return'"[Object]"';let L="",C="";M!==""&&(P=`,
${A+=M}`,L=" ");const F=Math.min(I,k);v&&!l(S)&&(z=u(z)),$.push(S);for(let U=0;U<F;U++){const D=z[U],J=_(D,S,$,T,M,A);J!==void 0&&(x+=`${C}${s(D)}:${L}${J}`,C=P)}return I>k&&(x+=`${C}"...":${L}"${g(I-k)} not stringified"`,C=P),M!==""&&C.length>1&&(x=`
${A}${x}
${j}`),$.pop(),`{${x}}`}case"number":return isFinite(S)?String(S):e?e(S):"null";case"boolean":return S===!0?"true":"false";case"undefined":return;case"bigint":if(d)return String(S);default:return e?e(S):void 0}}function E(R,y,$,T,M,A){switch(typeof y=="object"&&y!==null&&typeof y.toJSON=="function"&&(y=y.toJSON(R)),typeof y){case"string":return s(y);case"object":{if(y===null)return"null";if($.indexOf(y)!==-1)return o;const S=A;let x="",P=",";if(Array.isArray(y)){if(y.length===0)return"[]";if(w<$.length+1)return'"[Array]"';$.push(y),M!==""&&(x+=`
${A+=M}`,P=`,
${A}`);const I=Math.min(y.length,k);let L=0;for(;L<I-1;L++){const F=E(String(L),y[L],$,T,M,A);x+=F!==void 0?F:"null",x+=P}const C=E(String(L),y[L],$,T,M,A);return x+=C!==void 0?C:"null",y.length-1>k&&(x+=`${P}"... ${g(y.length-k-1)} not stringified"`),M!==""&&(x+=`
${S}`),$.pop(),`[${x}]`}$.push(y);let j="";M!==""&&(P=`,
${A+=M}`,j=" ");let z="";for(const I of T){const L=E(I,y[I],$,T,M,A);L!==void 0&&(x+=`${z}${s(I)}:${j}${L}`,z=P)}return M!==""&&z.length>1&&(x=`
${A}${x}
${S}`),$.pop(),`{${x}}`}case"number":return isFinite(y)?String(y):e?e(y):"null";case"boolean":return y===!0?"true":"false";case"undefined":return;case"bigint":if(d)return String(y);default:return e?e(y):void 0}}function O(R,y,$,T,M){switch(typeof y){case"string":return s(y);case"object":{if(y===null)return"null";if(typeof y.toJSON=="function"){if(typeof(y=y.toJSON(R))!="object")return O(R,y,$,T,M);if(y===null)return"null"}if($.indexOf(y)!==-1)return o;const A=M;if(Array.isArray(y)){if(y.length===0)return"[]";if(w<$.length+1)return'"[Array]"';$.push(y);let L=`
${M+=T}`;const C=`,
${M}`,F=Math.min(y.length,k);let U=0;for(;U<F-1;U++){const J=O(String(U),y[U],$,T,M);L+=J!==void 0?J:"null",L+=C}const D=O(String(U),y[U],$,T,M);return L+=D!==void 0?D:"null",y.length-1>k&&(L+=`${C}"... ${g(y.length-k-1)} not stringified"`),L+=`
${A}`,$.pop(),`[${L}]`}let S=Object.keys(y);const x=S.length;if(x===0)return"{}";if(w<$.length+1)return'"[Object]"';const P=`,
${M+=T}`;let j="",z="",I=Math.min(x,k);l(y)&&(j+=n(y,P,k),S=S.slice(y.length),I-=y.length,z=P),v&&(S=u(S)),$.push(y);for(let L=0;L<I;L++){const C=S[L],F=O(C,y[C],$,T,M);F!==void 0&&(j+=`${z}${s(C)}: ${F}`,z=P)}return x>k&&(j+=`${z}"...": "${g(x-k)} not stringified"`,z=P),z!==""&&(j=`
${M}${j}
${A}`),$.pop(),`{${j}}`}case"number":return isFinite(y)?String(y):e?e(y):"null";case"boolean":return y===!0?"true":"false";case"undefined":return;case"bigint":if(d)return String(y);default:return e?e(y):void 0}}function K(R,y,$){switch(typeof y){case"string":return s(y);case"object":{if(y===null)return"null";if(typeof y.toJSON=="function"){if(typeof(y=y.toJSON(R))!="object")return K(R,y,$);if(y===null)return"null"}if($.indexOf(y)!==-1)return o;let T="";if(Array.isArray(y)){if(y.length===0)return"[]";if(w<$.length+1)return'"[Array]"';$.push(y);const P=Math.min(y.length,k);let j=0;for(;j<P-1;j++){const I=K(String(j),y[j],$);T+=I!==void 0?I:"null",T+=","}const z=K(String(j),y[j],$);return T+=z!==void 0?z:"null",y.length-1>k&&(T+=`,"... ${g(y.length-k-1)} not stringified"`),$.pop(),`[${T}]`}let M=Object.keys(y);const A=M.length;if(A===0)return"{}";if(w<$.length+1)return'"[Object]"';let S="",x=Math.min(A,k);l(y)&&(T+=n(y,",",k),M=M.slice(y.length),x-=y.length,S=","),v&&(M=u(M)),$.push(y);for(let P=0;P<x;P++){const j=M[P],z=K(j,y[j],$);z!==void 0&&(T+=`${S}${s(j)}:${z}`,S=",")}return A>k&&(T+=`${S}"...":"${g(A-k)} not stringified"`),$.pop(),`{${T}}`}case"number":return isFinite(y)?String(y):e?e(y):"null";case"boolean":return y===!0?"true":"false";case"undefined":return;case"bigint":if(d)return String(y);default:return e?e(y):void 0}}return function(R,y,$){if(arguments.length>1){let T="";if(typeof $=="number"?T=" ".repeat(Math.min($,10)):typeof $=="string"&&(T=$.slice(0,10)),y!=null){if(typeof y=="function")return _("",{"":R},[],y,T,"");if(Array.isArray(y))return E("",R,[],function(M){const A=new Set;for(const S of M)(typeof S=="string"||typeof S=="number")&&A.add(String(S));return A}(y),T,"")}if(T.length!==0)return O("",R,[],T,"")}return K("",R,[])}}}(Z,Z.exports)),Z.exports}function B(){if(de)return he;function r(t){return t*Math.random()|0}return de=1,he={findNotMatching:function(t,c){const a=[];let i=0;for(let s=0;s<t.length;s++)for(let u=i;u<c.length;u++)t[s]!==c[u]&&(a.push(c[u]),i=u+1);return a},findMatchingIndexes:function(t,c){const a=[];let i=0;for(let s=0;s<t.length;s++)for(let u=i;u<c.length;u++)t[s]===c[u]&&(a.push(u),i=u+1);return a},bsearchIndex:function(t,c){let a=0,i=t.length-1;for(;a<=i;){const s=(a+i)/2|0;if(t[s]===c)return s;t[s]<c?a=s+1:i=s-1}return-1},wildcardMatch:function(t,c){if(t==="*"||t.length===c.length&&t===c)return!0;let a=0,i=0;for(;a<t.length&&i<c.length;)if(t[a]!==c[i]){if(t[a]!=="*")return!1;if(t[a+1]===c[i]){a++;continue}i++}else a++,i++;return a>=t.length-1},randomSubset:function(t,c){if(t.length<1||c<1)return[];const a=Math.min(t.length,c),i=(u=1,f=a,(u=Math.floor(u))+r(1+(f=Math.floor(f))-u)),s=new Set;var u,f;for(let n=0;n<i;n++)s.add(r(t.length));const l=[];for(const n of s)l.push(t[n]);return l},abstractLogging:function(){const t=()=>{};return{fatal:t,error:t,warn:t,info:t,debug:t,trace:t}},isServerSide:typeof window>"u"}}function we(){return ye?ge:(ye=1,ge=class{constructor(r){this.options=r}async get(r){throw new Error("storage get method not implemented")}async set(r,t,c,a){throw new Error("storage set method not implemented")}async remove(r){throw new Error("storage remove method not implemented")}async invalidate(r){throw new Error("storage invalidate method not implemented")}async clear(r){throw new Error("storage clear method not implemented")}async refresh(){throw new Error("storage refresh method not implemented")}})}var ke,Se,$e,ee={};function _e(){if($e)return Se;$e=1;var r=(ke||(ke=1,ee.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",ee.SYMBOL_SUPPORT=typeof Symbol<"u"),ee),t=r.ARRAY_BUFFER_SUPPORT,c=r.SYMBOL_SUPPORT;return Se=function(a,i){var s,u,f,l,n;if(!a)throw new Error("obliterator/forEach: invalid iterable.");if(typeof i!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(a)||t&&ArrayBuffer.isView(a)||typeof a=="string"||a.toString()==="[object Arguments]")for(f=0,l=a.length;f<l;f++)i(a[f],f);else if(typeof a.forEach!="function")if(c&&Symbol.iterator in a&&typeof a.next!="function"&&(a=a[Symbol.iterator]()),typeof a.next!="function")for(u in a)a.hasOwnProperty(u)&&i(a[u],u);else for(s=a,f=0;(n=s.next()).done!==!0;)i(n.value,f),f++;else a.forEach(i)}}var Ee,Ae={};function Re(){return Ee||(Ee=1,function(r){var t=Math.pow(2,8)-1,c=Math.pow(2,16)-1,a=Math.pow(2,32)-1,i=Math.pow(2,7)-1,s=Math.pow(2,15)-1,u=Math.pow(2,31)-1;r.getPointerArray=function(l){var n=l-1;if(n<=t)return Uint8Array;if(n<=c)return Uint16Array;if(n<=a)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},r.getSignedPointerArray=function(l){var n=l-1;return n<=i?Int8Array:n<=s?Int16Array:n<=u?Int32Array:Float64Array},r.getNumberType=function(l){return l===(0|l)?Math.sign(l)===-1?l<=127&&l>=-128?Int8Array:l<=32767&&l>=-32768?Int16Array:Int32Array:l<=255?Uint8Array:l<=65535?Uint16Array:Uint32Array:Float64Array};var f={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};r.getMinimalRepresentation=function(l,n){var h,p,g,b,m,e=null,o=0;for(b=0,m=l.length;b<m;b++)g=n?n(l[b]):l[b],p=r.getNumberType(g),(h=f[p.name])>o&&(o=h,e=p);return e},r.isTypedArray=function(l){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(l)},r.concat=function(){var l,n,h,p=0;for(l=0,h=arguments.length;l<h;l++)p+=arguments[l].length;var g=new arguments[0].constructor(p);for(l=0,n=0;l<h;l++)g.set(arguments[l],n),n+=arguments[l].length;return g},r.indices=function(l){for(var n=new(r.getPointerArray(l))(l),h=0;h<l;h++)n[h]=h;return n}}(Ae)),Ae}var Oe,Te,Me,xe,Ke,Pe,je,Le,ze,Ne,V={};function et(){if(Me)return Te;Me=1;var r=function(){if(be)return ve;function s(u){if(typeof u!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=u}return be=1,typeof Symbol<"u"&&(s.prototype[Symbol.iterator]=function(){return this}),s.of=function(){var u=arguments,f=u.length,l=0;return new s(function(){return l>=f?{done:!0}:{done:!1,value:u[l++]}})},s.empty=function(){return new s(function(){return{done:!0}})},s.fromSequence=function(u){var f=0,l=u.length;return new s(function(){return f>=l?{done:!0}:{done:!1,value:u[f++]}})},s.is=function(u){return u instanceof s||typeof u=="object"&&u!==null&&typeof u.next=="function"},ve=s}(),t=_e(),c=Re(),a=function(){if(Oe)return V;Oe=1;var s=_e(),u=Re();function f(l){return typeof l.length=="number"?l.length:typeof l.size=="number"?l.size:void 0}return V.isArrayLike=function(l){return Array.isArray(l)||u.isTypedArray(l)},V.guessLength=f,V.toArray=function(l){var n=f(l),h=typeof n=="number"?new Array(n):[],p=0;return s(l,function(g){h[p++]=g}),h},V.toArrayWithIndices=function(l){var n=f(l),h=typeof n=="number"?u.getPointerArray(n):Array,p=typeof n=="number"?new Array(n):[],g=typeof n=="number"?new h(n):[],b=0;return s(l,function(m){p[b]=m,g[b]=b++}),[p,g]},V}();function i(s,u,f){if(arguments.length<2&&(f=s,s=null,u=null),this.capacity=f,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var l=c.getPointerArray(f);this.forward=new l(f),this.backward=new l(f),this.K=typeof s=="function"?new s(f):new Array(f),this.V=typeof u=="function"?new u(f):new Array(f),this.size=0,this.head=0,this.tail=0,this.items={}}return i.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},i.prototype.splayOnTop=function(s){var u=this.head;if(this.head===s)return this;var f=this.backward[s],l=this.forward[s];return this.tail===s?this.tail=f:this.backward[l]=f,this.forward[f]=l,this.backward[u]=s,this.head=s,this.forward[s]=u,this},i.prototype.set=function(s,u){var f=this.items[s];if(typeof f<"u")return this.splayOnTop(f),void(this.V[f]=u);this.size<this.capacity?f=this.size++:(f=this.tail,this.tail=this.backward[f],delete this.items[this.K[f]]),this.items[s]=f,this.K[f]=s,this.V[f]=u,this.forward[f]=this.head,this.backward[this.head]=f,this.head=f},i.prototype.setpop=function(s,u){var f=null,l=null,n=this.items[s];return typeof n<"u"?(this.splayOnTop(n),f=this.V[n],this.V[n]=u,{evicted:!1,key:s,value:f}):(this.size<this.capacity?n=this.size++:(n=this.tail,this.tail=this.backward[n],f=this.V[n],l=this.K[n],delete this.items[l]),this.items[s]=n,this.K[n]=s,this.V[n]=u,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,l?{evicted:!0,key:l,value:f}:null)},i.prototype.has=function(s){return s in this.items},i.prototype.get=function(s){var u=this.items[s];if(!(typeof u>"u"))return this.splayOnTop(u),this.V[u]},i.prototype.peek=function(s){var u=this.items[s];if(!(typeof u>"u"))return this.V[u]},i.prototype.forEach=function(s,u){u=arguments.length>1?u:this;for(var f=0,l=this.size,n=this.head,h=this.K,p=this.V,g=this.forward;f<l;)s.call(u,p[n],h[n],this),n=g[n],f++},i.prototype.keys=function(){var s=0,u=this.size,f=this.head,l=this.K,n=this.forward;return new r(function(){if(s>=u)return{done:!0};var h=l[f];return++s<u&&(f=n[f]),{done:!1,value:h}})},i.prototype.values=function(){var s=0,u=this.size,f=this.head,l=this.V,n=this.forward;return new r(function(){if(s>=u)return{done:!0};var h=l[f];return++s<u&&(f=n[f]),{done:!1,value:h}})},i.prototype.entries=function(){var s=0,u=this.size,f=this.head,l=this.K,n=this.V,h=this.forward;return new r(function(){if(s>=u)return{done:!0};var p=l[f],g=n[f];return++s<u&&(f=h[f]),{done:!1,value:[p,g]}})},typeof Symbol<"u"&&(i.prototype[Symbol.iterator]=i.prototype.entries),i.prototype.inspect=function(){for(var s,u=new Map,f=this.entries();!(s=f.next()).done;)u.set(s.value[0],s.value[1]);return Object.defineProperty(u,"constructor",{value:i,enumerable:!1}),u},typeof Symbol<"u"&&(i.prototype[Symbol.for("nodejs.util.inspect.custom")]=i.prototype.inspect),i.from=function(s,u,f,l){if(arguments.length<2){if(typeof(l=a.guessLength(s))!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(l=u,u=null,f=null);var n=new i(u,f,l);return t(s,function(h,p){n.set(p,h)}),n},Te=i}function He(){if(je)return Pe;je=1;const{isServerSide:r}=B();let t;r&&(t=function(){if(me)return pe;me=1;const i=qe(),s=we(),{findNotMatching:u,randomSubset:f,abstractLogging:l}=B();return pe=class extends s{constructor(n={}){if(!n.client||typeof n.client!="object")throw new Error("Redis client is required");if(super(n),n.invalidation&&n.invalidation.referencesTTL&&(typeof n.invalidation.referencesTTL!="number"||n.invalidation.referencesTTL<1))throw new Error("invalidation.referencesTTL must be a positive integer greater than 1");this.log=n.log||l(),this.store=n.client,this.invalidation=!!n.invalidation,this.referencesTTL=n.invalidation&&n.invalidation.referencesTTL||60}getReferenceKeyLabel(n){return`r:${n}`}getKeyReferenceLabel(n){return`k:${n}`}async get(n){this.log.debug({msg:"acd/storage/redis.get",key:n});try{const h=await this.store.get(n);return h?JSON.parse(h):this.invalidation?void this.clearReferences(n):void 0}catch(h){this.log.error({msg:"acd/storage/redis.get error",err:h,key:n})}}async getTTL(n){this.log.debug({msg:"acd/storage/memory.getTTL",key:n});let h=await this.store.pttl(n);return h<0?0:(h=Math.ceil(h/1e3),h)}async set(n,h,p,g){if(this.log.debug({msg:"acd/storage/redis.set key",key:n,value:h,ttl:p,references:g}),(p=Number(p))&&!(p<0))try{if(await this.store.set(n,i(h),"EX",p),!g||g.length<1)return;if(!this.invalidation)return void this.log.warn({msg:"acd/storage/redis.set, invalidation is disabled, references are useless",key:n,references:g});const b=[],m=await this.store.smembers(this.getKeyReferenceLabel(n));if(this.log.debug({msg:"acd/storage/redis.set current references",key:n,currentReferences:m}),m.length>1){m.sort(),g.sort();const d=u(g,m);for(const v of d)b.push(["srem",this.getReferenceKeyLabel(v),n]);b.push(["del",this.getKeyReferenceLabel(n)])}const e=m.length>1?u(m,g):g;this.log.debug({msg:"acd/storage/redis.set references to add",key:n,referencesToAdd:e});for(let d=0;d<e.length;d++){const v=e[d],w=this.getReferenceKeyLabel(v);b.push(["sadd",w,n]),b.push(["expire",w,this.referencesTTL])}const o=this.getKeyReferenceLabel(n);b.push(["sadd",o,g]),b.push(["expire",o,p]),this.log.debug({msg:"acd/storage/redis.set references writes",writes:b}),await this.store.pipeline(b).exec()}catch(b){this.log.error({msg:"acd/storage/redis.set error",err:b,key:n,ttl:p,references:g})}}async remove(n){this.log.debug({msg:"acd/storage/redis.remove",key:n});try{const h=await this.store.del(n)>0;return h&&this.invalidation&&await this.clearReferences(n),h}catch(h){this.log.error({msg:"acd/storage/redis.remove error",err:h,key:n})}}async invalidate(n){if(!this.invalidation)return this.log.warn({msg:"acd/storage/redis.invalidate, exit due invalidation is disabled"}),[];this.log.debug({msg:"acd/storage/redis.invalidate",references:n});try{return Array.isArray(n)?await this._invalidateReferences(n):await this._invalidateReference(n)}catch(h){return this.log.error({msg:"acd/storage/redis.invalidate error",err:h,references:n}),[]}}async _invalidateReferences(n,h=!0){const p=n.map(e=>["smembers",h?this.getReferenceKeyLabel(e):e]),g=await this.store.pipeline(p).exec();this.log.debug({msg:"acd/storage/redis._invalidateReferences keys",keys:g});const b=[],m=[];for(let e=0;e<g.length;e++){const o=g[e][1];if(o){this.log.debug({msg:"acd/storage/redis._invalidateReferences got keys to be invalidated",keys:o});for(let d=0;d<o.length;d++){const v=o[d];this.log.debug({msg:"acd/storage/redis._invalidateReferences del key"+v}),m.push(v),b.push(["del",v])}}}return await this.store.pipeline(b).exec(),await this.clearReferences(m),m}async _invalidateReference(n){let h;if(n.includes("*")){const b=await this.store.keys(this.getReferenceKeyLabel(n));return this._invalidateReferences(b,!1)}h=await this.store.smembers(this.getReferenceKeyLabel(n)),this.log.debug({msg:"acd/storage/redis._invalidateReference keys",keys:h});const p=[],g=[];for(let b=0;b<h.length;b++){const m=h[b];this.log.debug({msg:"acd/storage/redis._invalidateReference del key"+m}),g.push(m),p.push(["del",m])}return await this.store.pipeline(p).exec(),await this.clearReferences(g),g}async clear(n){this.log.debug({msg:"acd/storage/redis.clear",name:n});try{if(!n)return void await this.store.flushall();const h=await this.store.keys(`${n}*`);this.log.debug({msg:"acd/storage/redis.clear keys",keys:h});const p=h.map(g=>["del",g]);if(await this.store.pipeline(p).exec(),!this.invalidation)return;await this.clearReferences(h)}catch(h){this.log.error({msg:"acd/storage/redis.clear error",err:h,name:n})}}async refresh(){try{await this.store.flushall()}catch(n){this.log.error({msg:"acd/storage/redis.refresh error",err:n})}}async clearReferences(n){try{if(!n)return void this.log.warn({msg:"acd/storage/redis.clearReferences invalid call due to empty key"});Array.isArray(n)||(n=[n]);const h=n.map(b=>["smembers",this.getKeyReferenceLabel(b)]),p=await this.store.pipeline(h).exec();this.log.debug({msg:"acd/storage/redis.clearReferences references",keys:n,referencesKeys:p});const g={};for(let b=0;b<n.length;b++){for(let e=0;e<p[b][1].length;e++){const o=this.getReferenceKeyLabel(p[b][1][e]);g[o]||(g[o]=["srem",o,n])}const m=this.getKeyReferenceLabel(n[b]);g[m]=["del",m]}this.log.debug({msg:"acd/storage/redis.clearReferences writes pipeline",writes:g}),await this.store.pipeline(Object.values(g)).exec()}catch(h){this.log.error({msg:"acd/storage/redis.clearReferences error",err:h})}}async gc(n="lazy",h={}){if(this.log.debug({msg:"acd/storage/redis.gc",mode:n,options:h}),!this.invalidation)return void this.log.warn({msg:"acd/storage/redis.gc does not run due to invalidation is disabled"});n!=="strict"&&n!=="lazy"&&(n="lazy");const p={references:{scanned:[],removed:[]},keys:{scanned:new Set,removed:new Set},loops:0,cursor:0,error:null};try{let g=0,b=64;if(h.chunk&&(typeof h.chunk!="number"||h.chunk<1))return p.error=new Error("chunk must be a positive integer greater than 1"),p;if(h.lazy){if(h.lazy.chunk){if(typeof h.lazy.chunk!="number"||h.lazy.chunk<1)return p.error=new Error("lazy.chunk must be a positive integer greater than 1"),p;b=h.lazy.chunk}if(h.lazy.cursor){if(typeof h.lazy.cursor!="number"||h.lazy.cursor<0)return p.error=new Error("lazy.cursor must be a positive integer greater than 0"),p;g=h.lazy.cursor}}const m=h.chunk||64,e=Math.min(b,m),o=g;let d=-1,v=-1;do{p.loops++;const w=await this.store.scan(g,"match","r:*","count",e);g=Number(w[0]),d=w[1].length;const k=n==="lazy"?f(w[1],b):w[1];p.references.scanned=p.references.scanned.concat(k);let _=[];for(let A=0;A<k.length;A++){const S=k[A];_.push(["smembers",S])}const E=await this.store.pipeline(_).exec(),O={},K={};for(let A=0;A<E.length;A++){const S=E[A],x=k[A];K[x]=S[1];for(let P=0;P<S[1].length;P++){const j=S[1][P];O[j]?O[j].push(x):O[j]=[x],p.keys.scanned.add(j)}}const R=Object.keys(O);_=R.map(A=>["exists",A]);const y=await this.store.pipeline(_).exec(),$={};for(let A=0;A<R.length;A++){const S=R[A];if(y[A][1]!==1)for(let x=0;x<O[S].length;x++){const P=O[S][x];$[P]?$[P].push(S):$[P]=[S],p.keys.removed.add(S)}}const T=Object.keys($),M=[];for(let A=0;A<T.length;A++){const S=T[A];K[S].length===$[S].length?(M.push(["del",S]),p.references.removed.push(S)):M.push(["srem",S,$[S]])}if(await this.store.pipeline(M).exec(),v=M.length,n==="lazy"&&p.references.scanned.length>=b)break}while(o!==g&&d>0&&v>0);p.cursor=g,p.keys.scanned=Array.from(p.keys.scanned),p.keys.removed=Array.from(p.keys.removed)}catch(g){this.log.error({msg:"acd/storage/redis.gc error",err:g}),p.error=g}return p}}}());const c=function(){if(Ke)return xe;Ke=1;const i=et(),{abstractLogging:s}=B(),u=we(),{findMatchingIndexes:f,findNotMatching:l,bsearchIndex:n,wildcardMatch:h}=B(),p=typeof globalThis.setImmediate<"u"?globalThis.setImmediate:(e,...o)=>setTimeout(e,0,...o);let g;function b(){if(g!==void 0)return g;g=Math.floor(Date.now()/1e3);const e=setTimeout(m,1e3);return typeof e.unref=="function"&&e.unref(),g}function m(){g=void 0}return xe=class extends u{constructor(e={}){if(e.size&&(typeof e.size!="number"||e.size<1))throw new Error("size must be a positive integer greater than 0");super(e),this.size=e.size||1024,this.log=e.log||s(),this.invalidation=e.invalidation||!1,this.init()}init(){this.store=new i(this.size),this.invalidation&&(this.keysReferences=new Map,this.referencesKeys=new Map)}get(e){this.log.debug({msg:"acd/storage/memory.get",key:e});const o=this.store.get(e);if(o){if(this.log.debug({msg:"acd/storage/memory.get, entry",entry:o,now:b()}),o.start+o.ttl>b())return this.log.debug({msg:"acd/storage/memory.get, key is NOT expired",key:e,entry:o}),o.value;this.log.debug({msg:"acd/storage/memory.get, key is EXPIRED",key:e,entry:o}),p(()=>this.remove(e))}}getTTL(e){this.log.debug({msg:"acd/storage/memory.getTTL",key:e});const o=this.store.peek(e);let d=0;return o&&(d=o.start+o.ttl-b(),d<0&&(d=0)),d}set(e,o,d,v){if(this.log.debug({msg:"acd/storage/memory.set",key:e,value:o,ttl:d,references:v}),!(d=Number(d))||d<0)return;const w=this.store.has(e),k=this.store.setpop(e,{value:o,ttl:d,start:b()});if(this.log.debug({msg:"acd/storage/memory.set, evicted",removed:k}),k&&k.evicted&&(this.log.debug({msg:"acd/storage/memory.set, remove evicted key",key:k.key}),this._removeReferences([k.key])),!v||v.length<1)return;if(!this.invalidation)return void this.log.warn({msg:"acd/storage/memory.set, invalidation is disabled, references are useless"});let _;if(v=[...new Set(v)],w&&(_=this.keysReferences.get(e),this.log.debug({msg:"acd/storage/memory.set, current keys-references",key:e,references:_}),_)){_.sort(),v.sort();const O=l(v,_);for(const K of O){const R=this.referencesKeys.get(K);if(!R)continue;const y=n(R,e);if(!(y<0)){if(R.splice(y,1),R.length<1){this.referencesKeys.delete(K);continue}this.referencesKeys.set(K,R)}}}const E=_?l(_,v):v;for(let O=0;O<E.length;O++){const K=E[O];let R=this.referencesKeys.get(K);R?(this.log.debug({msg:"acd/storage/memory.set, add reference-key",key:e,reference:K}),R.push(e)):R=[e],this.log.debug({msg:"acd/storage/memory.set, set reference-keys",keys:R,reference:K}),this.referencesKeys.set(K,R)}this.keysReferences.set(e,v)}remove(e){this.log.debug({msg:"acd/storage/memory.remove",key:e});const o=this._removeKey(e);return this._removeReferences([e]),o}_removeKey(e){return this.log.debug({msg:"acd/storage/memory._removeKey",key:e}),!!this.store.has(e)&&(this.store.set(e,void 0),!0)}_removeReferences(e){if(!this.invalidation)return;this.log.debug({msg:"acd/storage/memory._removeReferences",keys:e});const o=new Set;for(let d=0;d<e.length;d++){const v=e[d],w=this.keysReferences.get(v);if(w){for(let k=0;k<w.length;k++)o.add(w[k]);this.log.debug({msg:"acd/storage/memory._removeReferences, delete key-references",key:v}),this.keysReferences.delete(v)}}this._removeReferencesKeys([...o],e)}_removeReferencesKeys(e,o){o.sort(),this.log.debug({msg:"acd/storage/memory._removeReferencesKeys",references:e,keys:o});for(let d=0;d<e.length;d++){const v=e[d],w=this.referencesKeys.get(v);if(this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, get reference-key",reference:v,keys:o,referencesKeys:w}),!w)continue;const k=f(o,w);if(this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, removing",reference:v,referencesToRemove:k,referencesKeys:w}),k.length!==w.length)for(let _=k.length-1;_>=0;_--)this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, remove",reference:v,referencesKeys:w,at:k[_]}),w.splice(k[_],1);else this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, delete",reference:v}),this.referencesKeys.delete(v)}}invalidate(e){return this.invalidation?(this.log.debug({msg:"acd/storage/memory.invalidate",references:e}),Array.isArray(e)?this._invalidateReferences(e):this._invalidateReference(e)):(this.log.warn({msg:"acd/storage/memory.invalidate, exit due invalidation is disabled"}),[])}_invalidateReferences(e){const o=[];for(let d=0;d<e.length;d++){const v=e[d],w=this.referencesKeys.get(v);if(this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove keys on reference",reference:v,keys:w}),w){for(let k=0;k<w.length;k++){const _=w[k];this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove key on reference",reference:v,key:_}),this._removeKey(_)&&o.push(_)}this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove references of",reference:v,keys:w}),this._removeReferences([...w])}}return o}_invalidateReference(e){if(e.includes("*")){const v=[];for(const w of this.referencesKeys.keys())h(e,w)&&v.push(w);return this._invalidateReferences(v)}const o=this.referencesKeys.get(e),d=[];if(this.log.debug({msg:"acd/storage/memory._invalidateReference, remove keys on reference",reference:e,keys:o}),!o)return d;for(let v=0;v<o.length;v++){const w=o[v];this.log.debug({msg:"acd/storage/memory._invalidateReference, remove key on reference",reference:e,key:w}),this._removeKey(w)&&d.push(w)}return this.log.debug({msg:"acd/storage/memory._invalidateReference, remove references of",reference:e,keys:o}),this._removeReferences([...o]),d}clear(e){if(this.log.debug({msg:"acd/storage/memory.clear",name:e}),!e)return this.store.clear(),this.invalidation?(this.referencesKeys.clear(),void this.keysReferences.clear()):void 0;const o=[];this.store.forEach((v,w)=>{this.log.debug({msg:"acd/storage/memory.clear, iterate key",key:w}),w.indexOf(e)===0&&(this.log.debug({msg:"acd/storage/memory.clear, remove key",key:w}),o.push(w))});const d=[];for(let v=0;v<o.length;v++)this._removeKey(o[v])&&d.push(o[v]);return this._removeReferences(d),d}refresh(){this.log.debug({msg:"acd/storage/memory.refresh"}),this.init()}}}(),a="redis";return Pe=function(i,s){if(!r&&i===a)throw new Error("Redis storage is not supported in the browser");return i===a?new t(s):new c(s)}}function tt(){if(Le)return G;Le=1;const{kValues:r,kStorage:t,kStorages:c,kTransfromer:a,kTTL:i,kOnDedupe:s,kOnError:u,kOnHit:f,kOnMiss:l,kStale:n}=function(){if(fe)return ue;fe=1;const e=Symbol("values"),o=Symbol("kStorage"),d=Symbol("kStorages"),v=Symbol("kTransformer"),w=Symbol("kTTL"),k=Symbol("kOnDedupe"),_=Symbol("kOnError"),E=Symbol("kOnHit"),O=Symbol("kOnMiss"),K=Symbol("kStale");return ue={kValues:e,kStorage:o,kStorages:d,kTransfromer:v,kTTL:w,kOnDedupe:k,kOnError:_,kOnHit:E,kOnMiss:O,kStale:K}}(),h=qe(),p=He();class g{constructor(o,d,v,w,k,_,E,O,K,R,y,$){this.dedupes=new Map,this.func=o,this.name=d,this.serialize=v,this.references=w,this.storage=k,this.transformer=_,this.ttl=E,this.onDedupe=O,this.onError=K,this.onHit=R,this.onMiss=y,this.stale=$}getKey(o){const d=this.serialize?this.serialize(o):o;return typeof d=="string"?d:h(d)}getStorageKey(o){return`${this.name}~${o}`}getStorageName(){return`${this.name}~`}add(o){try{const d=this.getKey(o);let v=this.dedupes.get(d);return v?this.onDedupe(d):(v=new b,this.buildPromise(v,o,d),this.dedupes.set(d,v)),v.promise}catch(d){this.onError(d)}}async wrapFunction(o,d){const v=this.getStorageKey(d);if(this.ttl>0||typeof this.ttl=="function"){const w=await this.get(v);if(w!==void 0){this.onHit(d);const k=typeof this.stale=="function"?this.stale(w):this.stale;return k>0&&await this.storage.getTTL(v)<=k&&this._wrapFunction(v,o,d).catch(m),w}this.onMiss(d)}return this._wrapFunction(v,o,d)}async _wrapFunction(o,d,v){const w=await this.func(d,v),k=typeof this.stale=="function"?this.stale(w):this.stale;let _=typeof this.ttl=="function"?this.ttl(w):this.ttl;if(_==null||typeof _!="number"||!Number.isInteger(_))return this.onError(new Error("ttl must be an integer")),w;if(_+=k,_<1)return w;if(!this.references)return await this.set(o,w,_),w;try{let E=this.references(d,v,w),O=w;E&&typeof E.then=="function"&&(E=await E),this.transformer&&(O=this.transformer.serialize(w)),await this.storage.set(o,O,_,E)}catch(E){this.onError(E)}return w}buildPromise(o,d,v){o.promise=this.wrapFunction(d,v),o.promise.then(w=>(this.dedupes.delete(v),w)).catch(w=>{this.onError(w),this.dedupes.delete(v);const k=this.storage.remove(this.getStorageKey(v));k&&typeof k.catch=="function"&&k.catch(m)})}async clear(o){if(o){const d=this.getKey(o);return this.dedupes.delete(d),void await this.storage.remove(this.getStorageKey(d))}await this.storage.clear(this.getStorageName()),this.dedupes.clear()}async get(o){const d=await this.storage.get(o);return this.transformer&&d?await this.transformer.deserialize(d):d}async set(o,d,v,w){return this.transformer&&(d=this.transformer.serialize(d)),this.storage.set(o,d,v,w)}async invalidate(o){return this.storage.invalidate(o)}}class b{constructor(){this.promise=null}}function m(){}return G.Cache=class{constructor(e={}){if(!e.storage)throw new Error("storage is required");if(e.ttl&&typeof e.ttl=="number"&&(e.ttl<0||!Number.isInteger(e.ttl)))throw new Error("ttl must be a positive integer greater than 0");if(e.onDedupe&&typeof e.onDedupe!="function")throw new Error("onDedupe must be a function");if(e.onError&&typeof e.onError!="function")throw new Error("onError must be a function");if(e.onHit&&typeof e.onHit!="function")throw new Error("onHit must be a function");if(e.onMiss&&typeof e.onMiss!="function")throw new Error("onMiss must be a function");if(typeof e.stale=="number"&&!(Math.floor(e.stale)===e.stale&&e.stale>=0))throw new Error("stale must be an integer greater or equal to 0");this[r]={},this[t]=e.storage,this[c]=new Map,this[c].set("_default",e.storage),this[a]=e.transformer,this[i]=e.ttl||0,this[s]=e.onDedupe||m,this[u]=e.onError||m,this[f]=e.onHit||m,this[l]=e.onMiss||m,this[n]=e.stale||0}define(e,o,d){if(typeof o=="function"&&(d=o,o={}),e&&this[e])throw new Error(`${e} is already defined in the cache or it is a forbidden name`);if(o=o||{},typeof d!="function")throw new TypeError(`Missing the function parameter for '${e}'`);const v=o.serialize;if(v&&typeof v!="function")throw new TypeError("serialize must be a function");const w=o.references;if(w&&typeof w!="function")throw new TypeError("references must be a function");if(typeof o.ttl!="function"&&o.ttl&&(typeof o.ttl!="number"||o.ttl<0||!Number.isInteger(o.ttl)))throw new Error("ttl must be a positive integer greater than 0");let k;o.storage?(k=p(o.storage.type,o.storage.options),this[c].set(e,k)):k=this[t];const _=o.ttl!==void 0?o.ttl:this[i],E=o.stale!==void 0?o.stale:this[n],O=o.onDedupe||this[s],K=o.onError||this[u],R=o.onHit||this[f],y=o.onMiss||this[l],$=o.transformer||this[a],T=new g(d,e,v,w,k,$,_,O,K,R,y,E);return this[r][e]=T,this[e]=T.add.bind(T),this}async clear(e,o){if(e){if(!this[r][e])throw new Error(`${e} is not defined in the cache`);return void await this[r][e].clear(o)}const d=[];for(const v of Object.values(this[r]))d.push(v.clear());await Promise.all(d)}async get(e,o){if(!this[r][e])throw new Error(`${e} is not defined in the cache`);return this[r][e].get(o)}async set(e,o,d,v,w){if(!this[r][e])throw new Error(`${e} is not defined in the cache`);return this[r][e].set(o,d,v,w)}async invalidate(e,o){if(!this[r][e])throw new Error(`${e} is not defined in the cache`);return this[r][e].invalidate(o)}async invalidateAll(e,o="_default"){if(!this[c].has(o))throw new Error(`${o} storage is not defined in the cache`);await this[c].get(o).invalidate(e)}},G}var rt=function(){if(Ne)return ze;Ne=1;const{Cache:r}=tt(),t=He();return ze={Cache:r,createCache:function(c){c?c.storage||(c.storage={type:"memory"}):c={storage:{type:"memory"}};const a=t(c.storage.type,c.storage.options);return new r({...c,storage:a})},createStorage:t}}();let te=0,Ie=[],N=[],Ce=(r,t)=>{let c=[],a={get:()=>(a.lc||a.listen(()=>{})(),a.value),l:t||0,lc:0,listen:(i,s)=>(a.lc=c.push(i,s||a.l)/2,()=>{let u=c.indexOf(i);~u&&(c.splice(u,2),--a.lc||a.off())}),notify(i,s){let u=!N.length;for(let f=0;f<c.length;f+=2)N.push(c[f],c[f+1],a.value,i,s);if(u){for(let f=0;f<N.length;f+=5){let l;for(let n=f+1;!l&&(n+=5)<N.length;)N[n]<N[f+1]&&(l=N.push(N[f],N[f+1],N[f+2],N[f+3],N[f+4]));l||N[f](N[f+2],N[f+3],N[f+4])}N.length=0}},off(){},set(i){let s=a.value;s!==i&&(a.value=i,a.notify(s))},subscribe(i,s){let u=a.listen(i,s);return i(a.value),u},value:r};return a};const re=typeof document>"u"?"server":"browser";function Ue(r){return r.withConfig({allowReconfigure:!1})}const nt=r=>{const{ssr:t=!1,tag:c="core-loader"}=r;if(t&&r.client)throw new TypeError("`client` option is not allowed when `ssr: true`, use `setServerClient` from your server entry point instead");if(!t&&r.client===!1)throw new TypeError("You must set `ssr: true` when `client: false` is used");if(!t&&!r.client)throw new TypeError("`client` is required");let a=t?void 0:Ue(r.client);function i(h){return rt.createCache().define("fetch",async p=>{if(!h)throw new Error("You have to set the Sanity client with `setServerClient` before any data fetching is done");const{query:g,params:b={},perspective:m,useCdn:e,stega:o}=JSON.parse(p),{result:d,resultSourceMap:v}=await h.fetch(g,b,{tag:c,filterResponse:!1,perspective:m,useCdn:e,stega:o});return{result:d,resultSourceMap:v}})}function s(){const h=(a==null?void 0:a.config().perspective)||"published";return u.instance=i(a),{hydrate:(p,g,b)=>({loading:(b==null?void 0:b.data)===void 0||(b==null?void 0:b.sourceMap)===void 0,error:void 0,data:b==null?void 0:b.data,sourceMap:b==null?void 0:b.sourceMap,perspective:h}),fetch:(p,g,b,m)=>{if(m.signal.aborted)return;const e=(te+=1,()=>{if(te-=1,te===0){let o=Ie;Ie=[];for(let d of o)d()}});b.setKey("loading",!0),b.setKey("error",void 0),u.instance.fetch(JSON.stringify({query:p,params:g})).then(o=>{m.signal.aborted||(b.setKey("data",o.result),b.setKey("sourceMap",o.resultSourceMap),b.setKey("perspective",h))}).catch(o=>{b.setKey("error",o)}).finally(()=>{b.setKey("loading",!1),e()})}}}const u={instance:i(a)},f=Ce(a?s():void 0),l=(h=>{const{ssr:p,setFetcher:g}=h;return b=>{if(re==="server")throw new Error("Live mode is not supported in server environments");if(p&&!b.client)throw new Error("The `client` option in `enableLiveMode` is required");const m=b.client||h.client||void 0,e=new AbortController;let o;return Ye(async()=>{const{enableLiveMode:d}=await import("./enableLiveMode.DPEjVY0o.js");return{enableLiveMode:d}},__vite__mapDeps([0,1,2,3])).then(({enableLiveMode:d})=>{e.signal.aborted||(o=d({...b,client:m,setFetcher:g,ssr:p}))}),()=>{e.abort(),o==null||o()}}})({client:a||void 0,ssr:t,setFetcher:h=>{const p=f.get();return f.set(h),()=>f.set(p)}}),n={instance:void 0,canPreviewDrafts:!1};return{createFetcherStore:(h,p={},g)=>{const b=f.get(),m=((_={})=>{let E=Ce(_);return E.setKey=function(O,K){let R=E.value;typeof K>"u"&&O in E.value?(E.value={...E.value},delete E.value[O],E.notify(R,O)):E.value[O]!==K&&(E.value={...E.value,[O]:K},E.notify(R,O))},E})(b?b.hydrate(h,p,g):{loading:!1,error:typeof(g==null?void 0:g.data)>"u"?new Error("The `initial` option is required when `ssr: true`"):void 0,data:g==null?void 0:g.data,sourceMap:g==null?void 0:g.sourceMap,perspective:g==null?void 0:g.perspective});return o=()=>{let _=new AbortController;const E=f.subscribe(O=>{!O||_.signal.aborted||(_.abort(),_=new AbortController,O.fetch(h,p,m,_))});return()=>{_.abort(),E()}},v=_=>{let E=o(_);E&&e.events[6].push(E)},w=5,k=_=>{let E=e.listen;e.listen=(...K)=>(!e.lc&&!e.active&&(e.active=!0,_()),E(...K));let O=e.off;return e.events[6]=[],e.off=()=>{O(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let K of e.events[6])K();e.events[6]=[]}},1e3)},()=>{e.listen=E,e.off=O}},(d=e=m).events=d.events||{},d.events[w+10]||(d.events[w+10]=k(_=>{d.events[w].reduceRight((E,O)=>(O(E),E),{shared:{},..._})})),d.events[w]=d.events[w]||[],d.events[w].push(v),m;var e,o,d,v,w,k},enableLiveMode:l,setServerClient:h=>{if(re!=="server")throw new Error("`setServerClient` can only be called in server environments, detected: "+JSON.stringify(re));if(!t)throw new Error("`setServerClient` can only be called when `ssr: true`");n.instance=a=Ue(h),n.canPreviewDrafts=!!a.config().token,f.set(s())},unstable__cache:u,unstable__serverClient:n}};function it(r){return Ve(typeof r=="object"?r==null?void 0:r.config().stega.studioUrl:void 0)}function st({enableLiveMode:r,studioUrlStore:t}){return({allowStudioOrigin:c,client:a,onConnect:i,onDisconnect:s,studioUrl:u}={})=>(c&&console.warn("`allowStudioOrigin` is deprecated and no longer needed"),t.set(u??(typeof a=="object"?a==null?void 0:a.config().stega.studioUrl:void 0)),r({client:a,onConnect:i,onDisconnect:s}))}var ot=function r(t,c){if(t===c)return!0;if(t&&c&&typeof t=="object"&&typeof c=="object"){if(t.constructor!==c.constructor)return!1;var a,i,s;if(Array.isArray(t)){if(a=t.length,a!=c.length)return!1;for(i=a;i--!==0;)if(!r(t[i],c[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===c.source&&t.flags===c.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===c.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===c.toString();if(s=Object.keys(t),a=s.length,a!==Object.keys(c).length)return!1;for(i=a;i--!==0;)if(!Object.prototype.hasOwnProperty.call(c,s[i]))return!1;for(i=a;i--!==0;){var u=s[i];if(!r(t[u],c[u]))return!1}return!0}return t!==t&&c!==c};const at=Ge(ot),ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ne=/_key\s*==\s*['"](.*)['"]/,ut=/^\d*:\d*$/;function ie(r){return typeof r=="number"||typeof r=="string"&&/^\[\d+\]$/.test(r)}function Q(r){return typeof r=="string"?ne.test(r.trim()):typeof r=="object"&&"_key"in r}function Be(r){if(typeof r=="string"&&ut.test(r))return!0;if(!Array.isArray(r)||r.length!==2)return!1;const[t,c]=r;return(typeof t=="number"||t==="")&&(typeof c=="number"||c==="")}function ft(r,t,c){const a=typeof t=="string"?se(t):t;if(!Array.isArray(a))throw new Error("Path must be an array or a string");let i=r;for(let s=0;s<a.length;s++){const u=a[s];if(ie(u)){if(!Array.isArray(i))return c;i=i[u]}if(Q(u)){if(!Array.isArray(i))return c;i=i.find(f=>f._key===u._key)}if(typeof u=="string"&&(i=typeof i=="object"&&i!==null?i[u]:void 0),typeof i>"u")return c}return i}function lt(r){if(!Array.isArray(r))throw new Error("Path is not an array");return r.reduce((t,c,a)=>{const i=typeof c;if(i==="number")return`${t}[${c}]`;if(i==="string")return`${t}${a===0?"":"."}${c}`;if(Q(c)&&c._key)return`${t}[_key=="${c._key}"]`;if(Array.isArray(c)){const[s,u]=c;return`${t}[${s}:${u}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(c)}\``)},"")}function se(r){if(typeof r!="string")throw new Error("Path is not a string");const t=r.match(ct);if(!t)throw new Error("Invalid path string");return t.map(ht)}function ht(r){return ie(r)?dt(r):Q(r)?gt(r):Be(r)?yt(r):r}function dt(r){return Number(r.replace(/[^\d]/g,""))}function gt(r){return{_key:r.match(ne)[1]}}function yt(r){const[t,c]=r.split(":").map(a=>a===""?a:Number(a));return[t,c]}var oe=Object.freeze({__proto__:null,fromString:se,get:ft,isIndexSegment:ie,isIndexTuple:Be,isKeySegment:Q,reKeySegment:ne,toString:lt});const De="drafts.";function pt(r){return r.startsWith(De)?r.slice(De.length):r}const Fe={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},Je={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function mt(r){return`$${r.map(t=>typeof t=="string"?`['${t.replace(/[\f\n\r\t'\\]/g,c=>Fe[c])}']`:typeof t=="number"?`[${t}]`:t._key!==""?`[?(@._key=='${t._key.replace(/['\\]/g,c=>Fe[c])}')]`:`[${t._index}]`).join("")}`}function vt(r){const t=[],c=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let a;for(;(a=c.exec(r))!==null;){if(a[1]!==void 0){const i=a[1].replace(/\\(\\|f|n|r|t|')/g,s=>Je[s]);t.push(i);continue}if(a[2]!==void 0){t.push(parseInt(a[2],10));continue}if(a[3]!==void 0){const i=a[3].replace(/\\(\\')/g,s=>Je[s]);t.push({_key:i,_index:-1});continue}}return t}function bt(r){return r.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._key!=="")return{_key:t._key};if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function wt(r){return(typeof r=="string"?se(r):r).map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))throw new Error(`IndexTuple segments aren't supported:${JSON.stringify(t)}`);if(kt(t))return t;if(t._key)return{_key:t._key,_index:-1};throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function kt(r){return typeof r=="object"&&"_key"in r&&"_index"in r}function St(r){return r.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function $t(r,t){if(!(t!=null&&t.mappings))return;const c=mt(St(r));if(t.mappings[c]!==void 0)return{mapping:t.mappings[c],matchedPath:c,pathSuffix:""};const a=Object.entries(t.mappings).filter(([f])=>c.startsWith(f)).sort(([f],[l])=>l.length-f.length);if(a.length==0)return;const[i,s]=a[0],u=c.substring(i.length);return{mapping:s,matchedPath:i,pathSuffix:u}}function _t(r){const{resultSourceMap:t,resultPath:c}=r,{mapping:a,pathSuffix:i}=$t(c,t)||{};if(!a||a.source.type==="literal"||a.source.type==="unknown")return;const s=t.documents[a.source.document],u=t.paths[a.source.path];if(s&&u){const{baseUrl:f,workspace:l,tool:n}=Et(typeof r.studioUrl=="function"?r.studioUrl(s):r.studioUrl);if(!f)return;const{_id:h,_type:p,_projectId:g,_dataset:b}=s;return{baseUrl:f,workspace:l,tool:n,id:h,type:p,path:vt(u+i),projectId:g,dataset:b}}}function Et(r){let t=typeof r=="string"?r:r.baseUrl;return t!=="/"&&(t=t.replace(/\/$/,"")),typeof r=="string"?{baseUrl:t}:{...r,baseUrl:t}}function Y(r,t,c,a,i){const s=i&&"input"in i?i.input:c.value,u=(i==null?void 0:i.expected)??r.expects,f=(i==null?void 0:i.received)??function(p){var b,m;let g=typeof p;return g==="object"&&(g=(p&&((m=(b=Object.getPrototypeOf(p))==null?void 0:b.constructor)==null?void 0:m.name))??"null"),g==="string"?`"${p}"`:g==="number"||g==="bigint"||g==="boolean"?`${p}`:g}(s),l={kind:r.kind,type:r.type,input:s,expected:u,received:f,message:`Invalid ${t}: ${u?`Expected ${u} but r`:"R"}eceived ${f}`,requirement:r.requirement,path:i==null?void 0:i.path,issues:i==null?void 0:i.issues,lang:a.lang,abortEarly:a.abortEarly,abortPipeEarly:a.abortPipeEarly,skipPipe:a.skipPipe},n=r.kind==="schema",h=r.message??(r.reference,void l.lang)??(n?void l.lang:null)??a.message??void l.lang;h&&(l.message=typeof h=="function"?h(l):h),n&&(c.typed=!1),c.issues?c.issues.push(l):c.issues=[l]}function At(r){return r!=="__proto__"&&r!=="prototype"&&r!=="constructor"}function ae(r,t){return{kind:"schema",type:"object",reference:ae,expects:"Object",async:!1,entries:r,message:t,_run(c,a){var s;const i=c.value;if(i&&typeof i=="object"){c.typed=!0,c.value={};for(const u in this.entries){const f=i[u],l=this.entries[u]._run({typed:!1,value:f},a);if(l.issues){const n={type:"object",origin:"value",input:i,key:u,value:f};for(const h of l.issues)h.path?h.path.unshift(n):h.path=[n],(s=c.issues)==null||s.push(h);if(c.issues||(c.issues=l.issues),a.abortEarly){c.typed=!1;break}}l.typed||(c.typed=!1),(l.value!==void 0||u in i)&&(c.value[u]=l.value)}}else Y(this,"type",c,a);return c}}}function W(r,...t){const c={kind:"schema",type:"optional",reference:W,expects:`${r.expects} | undefined`,async:!1,wrapped:r,_run(a,i){return a.value===void 0&&("default"in this&&(a.value=function(s,u,f){return typeof s.default=="function"?s.default(u,f):s.default}(this,a,i)),a.value===void 0)?(a.typed=!0,a):this.wrapped._run(a,i)}};return 0 in t&&(c.default=t[0]),c}function X(r){return{kind:"schema",type:"string",reference:X,expects:"string",async:!1,message:r,_run(t,c){return typeof t.value=="string"?t.typed=!0:Y(this,"type",t,c),t}}}function Rt(r){return r!==null&&Array.isArray(r)}function Ot(r){let t="";for(const c of r)typeof c!="string"?typeof c!="number"?Rt(c)?(t&&(t+=":"),t+=`${c.join(",")}}`):c._key&&(t&&(t+=":"),t+=`${c._key}`):(t&&(t+=":"),t+=`${c}`):(t&&(t+="."),t+=c);return t}const q=function(...r){return{...r[0],pipe:r,_run(t,c){for(let a=0;a<r.length;a++){t=r[a]._run(t,c);const i=r[a+1];if(c.skipPipe||t.issues&&(c.abortEarly||c.abortPipeEarly||(i==null?void 0:i.kind)==="schema"||(i==null?void 0:i.kind)==="transformation")){t.typed=!1;break}}return t}}}(X(),function r(t,c){return{kind:"validation",type:"min_length",reference:r,async:!1,expects:`>=${t}`,requirement:t,message:c,_run(a,i){return a.typed&&a.value.length<this.requirement&&Y(this,"length",a,i,{received:`${a.value.length}`}),a}}}(1)),H=W(q),Tt=ae({baseUrl:q,dataset:H,id:q,path:q,projectId:H,tool:H,type:H,workspace:H,isDraft:W(X())});function Mt(r){const{id:t,path:c,baseUrl:a,tool:i,workspace:s,type:u}=r;return f=r,Tt._run({typed:!1,value:f},{abortEarly:!0}).issues?void 0:[["id",pt(t)],["type",u],["path",Ot(oe.fromString(c))],["base",encodeURIComponent(a)],["workspace",s],["tool",i],["isDraft",t.startsWith("drafts.")]].filter(([,l])=>!!l).map(l=>{const[n,h]=l;return h===!0?n:l.join("=")}).join(";");var f}ae({origin:q,href:q,data:W(function r(t,c,a){return{kind:"schema",type:"record",reference:r,expects:"Object",async:!1,key:t,value:c,message:a,_run(i,s){var f,l;const u=i.value;if(u&&typeof u=="object"){i.typed=!0,i.value={};for(const n in u)if(At(n)){const h=u[n],p=this.key._run({typed:!1,value:n},s);if(p.issues){const b={type:"record",origin:"key",input:u,key:n,value:h};for(const m of p.issues)m.path=[b],(f=i.issues)==null||f.push(m);if(i.issues||(i.issues=p.issues),s.abortEarly){i.typed=!1;break}}const g=this.value._run({typed:!1,value:h},s);if(g.issues){const b={type:"record",origin:"value",input:u,key:n,value:h};for(const m of g.issues)m.path?m.path.unshift(b):m.path=[b],(l=i.issues)==null||l.push(m);if(i.issues||(i.issues=g.issues),s.abortEarly){i.typed=!1;break}}(!p.typed||!g.typed)&&(i.typed=!1),p.typed&&(i.value[p.value]=g.value)}}else Y(this,"type",i,s);return i}}}(X(),function r(){return{kind:"schema",type:"unknown",reference:r,expects:"unknown",async:!1,_run:t=>(t.typed=!0,t)}}()))});const xt=(r,t,c,a)=>{if(!t||!c)return;const i=wt(a),s=_t({resultPath:i,resultSourceMap:t,studioUrl:c});return s?Mt({baseUrl:s.baseUrl,workspace:s.workspace,tool:s.tool,type:s.type,id:s.id,path:typeof s.path=="string"?s.path:oe.toString(bt(s.path))}):void 0};function Qe(r,t,c,a){const i=u=>u?typeof u=="string"?oe.fromString(u):u:[],s=i(a);return Object.assign(u=>xt(0,t,c,[...s,...i(u)]),{scope:u=>Qe(r,t,c,[...s,...i(u)])})}function Kt(r,t,c){return Qe(r,t,c)}function Pt({createFetcherStore:r,studioUrlStore:t}){const c={},a={};return(i,s=c,u=a)=>{typeof i=="object"&&(s=i.params||c,u=i.options||a,i=i.query);const f=u.initial?{perspective:"published",...u.initial}:void 0,l=JSON.stringify(s),n=r(i,JSON.parse(l),f),h=Ve(n.value);return Ze(()=>n.subscribe(p=>{const g=We(h);g.error!==p.error&&h.set(p),g.loading!==p.loading&&h.set(p),g.perspective!==p.perspective&&h.set(p),at(g.data,p.data)||h.set(p)})),Xe([h,t],([p,g])=>({...p,encodeDataAttribute:Kt(p.data,p.sourceMap,g)}))}}const jt=r=>{const{createFetcherStore:t,setServerClient:c,enableLiveMode:a,unstable__cache:i,unstable__serverClient:s}=nt({tag:"svelte-loader",...r}),u=it(r.client),f=Pt({createFetcherStore:t,studioUrlStore:u}),l=st({enableLiveMode:a,studioUrlStore:u});return{loadQuery:async(h,p={},g={})=>{var k,_;const{headers:b,tag:m}=g,e=g.perspective||((k=s.instance)==null?void 0:k.config().perspective)||"published",o=g.stega??((_=s.instance)==null?void 0:_.config().stega)??!1;if(typeof document<"u")throw new Error("Cannot use `loadQuery` in a browser environment, you should use it inside a load function.");if(e!=="published"&&!s.instance)throw new Error('You cannot use other perspectives than "published" unless call "setServerClient" first.');if(e==="previewDrafts"){if(!s.canPreviewDrafts)throw new Error('You cannot use "previewDrafts" unless you set a "token" in the "client" instance passed to "setServerClient".');const{result:E,resultSourceMap:O}=await s.instance.fetch(h,p,{filterResponse:!1,resultSourceMap:"withKeyArraySelector",perspective:e,useCdn:!1,headers:b,tag:m,stega:o});return{data:E,sourceMap:O,perspective:e}}const d=g.useCdn||s.instance.config().useCdn,{result:v,resultSourceMap:w}=await i.instance.fetch(JSON.stringify({query:h,params:p,perspective:e,useCdn:d,stega:o}));return w?{data:v,sourceMap:w}:{data:v}},useQuery:f,setServerClient:c,useLiveMode:l,unstable__serverClient:s}},{loadQuery:Ct,setServerClient:Ut,useLiveMode:Dt,useQuery:Ft,unstable__serverClient:Jt}=jt({client:!1,ssr:!0});export{Ce as U,Ft as u};
